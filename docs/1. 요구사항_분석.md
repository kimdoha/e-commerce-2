## 1. 요구사항 분석
`E-Commerce` 상품 주문 서비스를 구현합니다.  
상품과 주문에 필요한 메뉴 정보들을 구성하고 조회가 가능해야 합니다.  
사용자는 상품을 여러개 선택해 주문할 수 있고, 미리 충전한 잔액을 이용합니다.  
상품 주문 내역을 통해 판매량이 가장 높은 상품을 추천합니다.

### 기능적 요구사항
1. 잔액 충전/조회 API

   - 사용자 식별자와 충전 금액을 입력받는 API 구현
   - 사용자별 잔액 조회 API 구현  
   - 잔액 정보 영속성 보장

2. 상품 조회 API

   - 상품 ID, 이름, 가격, 잔여수량 정보를 제공하는 API 구현  
   - 실시간 재고 정보 제공 (동시성 고려)

3. 선착순 쿠폰 기능

   - 사용자가 쿠폰을 발급받을 수 있는 API 구현
   - 쿠폰 수량 제한 및 선착순 로직 구현  
   - 주문 시 쿠폰 적용 로직 구현

4. 주문/결제 API

   - 사용자 식별자, 상품 ID, 수량 목록을 입력받는 API 구현  
   - 결제 처리 및 잔액 차감 로직 구현  
   - 외부 데이터 플랫폼으로 주문 정보 전송 기능 구현

5. 상위 상품 조회 API
   
   - 최근 3일간 판매량 기준 상위 5개 상품 정보 제공 API 구현
   - 통계 데이터 수집 및 데이터 가공 구현

### 도메인 요구사항
1. 사용자 도메인

   - 사용자는 고유 식별자로 구분됨
   - 사용자는 충전 가능한 잔액을 보유함

2. 상품 도메인
   - 상품은 ID, 이름, 가격, 재고 수량 속성을 가짐
   - 재고 수량은 주문에 따라 감소함

3. 쿠폰 도메인

   - 쿠폰은 발급 수량이 제한됨
   - 쿠폰은 사용자별로 발급되고 관리됨
   - 쿠폰은 1인 1개만 발급 가능

4. 주문/결제 도메인

   - 주문은 사용자, (상품 목록, 수량) 으로 구성됨
   - 결제는 사용자 포인트 잔액으로 이루어짐
   - 결제 성공 시 외부 시스템으로 데이터 전송이 필요함
   - 결제는 재고 확인 후 진행되어야 함
   - 결제 과정에서 쿠폰 적용이 가능함

5. 통계 도메인

   - 상품별 판매량 통계 데이터 관리 필요  
   - 통계 조회 시 최근 3일간의 데이터 필요
   - 데이터는 판매량 기준으로 정렬되어야 함




### 비기능적 요구사항
- **재고 관리에 문제 없도록 구현**
- **동시성 이슈를 고려하여 구현**
- **다수의 인스턴스 어플리케이션 동작하더라도 기능에 문제 없도록 구현**


### E-Commerce 시스템 기본 정책

1. 모든 데이터 삭제는 물리 삭제로 진행됩니다.
2. 상품 전시 브랜드 및 카테고리 관리는 생략합니다.
3. 모든 인증 요청은 인증 서버를 통해 게이트웨이 단계에서 사전 검증됩니다.

### 회원 정책
1. 회원 가입 시 유저 포인트는 기본 잔액 0원으로 자동 생성됩니다.



### 포인트 충전 정책

1. 충전 금액 제한
   - 최소 충전 금액: 10,000원
   - 최대 충전 금액: 500,000원

2. 충전 단위: 10,000원, 50,000원, 100,000원, 500,000원 단위로만 충전 가능합니다.
3. 최대 포인트 보유 한도: 2,000,000원 (이 금액을 초과하는 충전은 불가합니다.)



### 상품 정책

1. 상품은 반드시 하나 이상의 옵션을 가져야 합니다.
2. 상품당 최대 10개의 옵션을 등록할 수 있습니다.
3. 상품 이름과 옵션 이름은 각각 중복될 수 없습니다.
4. 상품의 브랜드 및 카테고리 관리는 현재 범위에서 제외합니다.



### 가격 정책

1. `상품 최종 금액 = 상품 기본 금액 + 옵션 추가 금액 - 할인 금액`
2. 할인 금액은 적용 가능한 쿠폰에 따라 결정됩니다.
3. 할인 정책은 정액 할인으로 고정합니다.


### 재고 정책

1. 재고는 **상품 옵션** 기준으로 관리됩니다.
2. 재고는 총 재고량과 예약 재고량으로 구분합니다.
3. 실제 구매 가능한 재고 = 총 재고량 - 예약 재고량
4. 주문 시점에 예약 재고량을 증가시키고, 결제 완료 시 총 재고량에서 차감합니다.
5. 결제 실패나 주문 취소 시 예약 재고량을 감소시킵니다.



### 인기 상품 집계

1. 일별 상품 판매 데이터는 일 단위로 스케줄러를 통해 자동 집계됩니다.
2. 3일간 인기 상품은 일별 판매 데이터를 집계해 생성합니다.

### 주문 정책
1. 주문 생성 시, 주문 식별자는 유니크한 문자열로 생성됩니다.
2. 주문 시, 쿠폰 사용하면 이벤트로 쿠폰 발행 내역이 업데이트 됩니다.

### 결제 정책
1. 배송비 금액 및 배송비 할인 금액은 제외합니다
